import{P as X}from"../countries.js";import{e as b,U as Y}from"../transform-shipping-methods.js";import{events as Z}from"@dropins/tools/event-bus.js";import{p as H,g as D,a as rr}from"../placeOrder2.js";import{i as tr}from"../IsBillToShippingSignal.js";import{C as h}from"../usePreselectedFields.js";import"@dropins/tools/preact-hooks.js";import"../BillToShippingAddress.js";import{jsx as r,jsxs as v}from"@dropins/tools/preact-jsx-runtime.js";import{I as O}from"../IllustratedMessage.js";import er from"../Cart.js";import{u as S,c as a,T as or,M as ir}from"../preact-i18n.esm.js";import{I as y}from"../Icon.js";import{B as C}from"../Button.js";import I from"../OrderError.js";import{S as sr}from"../ShippingMethods.js";import{L as nr}from"../LoginForm.js";import{useState as f,useCallback as ar,useEffect as P}from"@dropins/tools/preact-compat.js";import{S as cr}from"../ShippingForm.js";import{B as mr}from"../BillToShippingAddress2.js";import{O as pr}from"../OrderSummary.js";import{S as d,P as dr}from"../PaymentMethods.js";import{B as lr}from"../BillingForm.js";import{P as ur}from"../PlaceOrder.js";import{E as hr}from"../ErrorBanner.js";import{C as fr}from"../CartSummary.js";import"@dropins/tools/preact.js";import"@dropins/tools/fetch-graphql.js";import"../transform-cart.js";import"../cart-item.js";import"../estimateShippingMethods.js";import"../vcomponent.js";import"../WarningWithCircle.js";import"../CheckWithCircle.js";import"../ChevronDown.js";import"../ProgressSpinner.js";import"../SelectedShippingMethodSignal.js";import"../setShippingMethods.js";import"../Delivery.js";import"../Price.js";import"../setGuestEmailOnCart.js";import"../constants2.js";import"../setBillingAddress.js";import"../setShippingAddress.js";import"../constants3.js";import"../Check.js";import"../Divider.js";import"../setPaymentMethod.js";import"../Wallet.js";import"../constants.js";import"../Close.js";import"../WarningFilled.js";import"../UIProvider.js";import"../Minus.js";import"../Add.js";import"../Trash.js";import"../image-params-keymap.js";const Sr=({className:c,title:m,routeHome:e,...t})=>{const s=S({Title:"Checkout.EmptyCart.title",Button:"Checkout.EmptyCart.button"});return r(O,{...t,"data-testid":"checkout-empty-cart",className:a(["checkout-empty-cart",c]),heading:m??s.Title,icon:r(y,{className:a(["checkout-empty-cart__icon"]),source:er}),action:e!=null&&e()?r(C,{className:"checkout-empty-cart__button",size:"medium",variant:"primary",type:"submit",href:e==null?void 0:e(),children:s.Button},"routeHome"):void 0})},kr=({className:c,icon:m,routeCart:e,...t})=>{const s=S({Title:"Checkout.OutOfStock.title",Message:"Checkout.OutOfStock.message"});return v("div",{...t,className:a(["checkout-out-of-stock",c]),"data-testid":"checkout-out-of-stock",children:[r(O,{heading:s.Title,message:r("p",{children:s.Message}),icon:r(y,{source:m??I,className:a(["checkout-out-of-stock__icon"])})}),(e==null?void 0:e())&&r(C,{className:"checkout-out-of-stock__button",size:"medium",variant:"primary",type:"submit",href:e==null?void 0:e(),children:r(or,{id:"Checkout.OutOfStock.button"})},"routeCart")]})},gr=({className:c,errorMessage:m,contactSupport:e,...t})=>{const{onClick:s}=t,p=S({Title:"Checkout.ServerError.title",Message:"Checkout.ServerError.message",ContactSupport:"Checkout.ServerError.contactSupport",Button:"Checkout.ServerError.button"});return r(O,{"aria-invalid":"true","aria-describedby":"checkout-server-error__message","aria-live":"polite",className:a(["checkout-server-error",c]),"data-testid":"checkout-server-error",heading:m??p.Title,message:v("p",{id:a(["checkout-server-error__message"]),children:[p.Message,r("br",{}),r(ir,{id:"",children:e??p.ContactSupport})]}),icon:r(y,{className:a(["checkout-server-error__icon"]),source:I}),action:r(C,{className:a(["checkout-server-error__button"]),onClick:s,children:p.Button})})},Ct="OUT_OF_STOCK",Et=c=>{const{className:m,cartId:e,slots:t,routeHome:s,routeCart:p,preselectedCartData:l,...x}=c,[E,M]=f(""),[F,N]=f(),[k,U]=f(!1),[A,w]=f(!1),L=!!e,{data:i}=b.value,z=i!==void 0,u=(i==null?void 0:i.virtual)||!1,j=L&&!z,K=E!=="",T=i==null?void 0:i.items,q=T!==void 0&&T.length>0,R=!j&&!q,V=S({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),$=ar(async()=>{i&&(await H(i.id),b.value={pending:!1},U(!0))},[i]),G=o=>{N(()=>o)},J=async()=>{M(""),i&&await g(i.id)},_=o=>{M(o instanceof TypeError||o instanceof Y?V.CheckoutUnexpectedError:o.message)},g=async o=>{const n=await D(o);n!=null&&n.virtual&&(tr.value={checked:!1,setByUser:!1})},B=async o=>{const n=await rr(o);w(n===X.OutOfStock)};if(P(()=>{!e||k||(g(e),B(e))},[e,k]),P(()=>{const o=Z.on("cart/data",n=>{!e&&n&&(g(n.id),B(n.id))},{eager:!0});return()=>{o==null||o.off()}},[e]),k)return null;if(R)return r(Sr,{routeHome:s});if(K)return r(gr,{errorMessage:E,onClick:J});const Q=()=>A?r(h.Main,{outOfStock:r(kr,{routeCart:p})}):r(h.Main,{sections:{billingAddress:r(d,{name:"BillingForm",slot:t==null?void 0:t.BillingForm,children:r(lr,{})}),billToShippingAddress:u?void 0:r(d,{name:"BillToShipping",slot:t==null?void 0:t.BillToShipping,children:r(mr,{})}),login:r(d,{name:"Login",slot:t==null?void 0:t.Login,children:r(nr,{})}),paymentMethods:r(dr,{isShippingInfoRequired:!u,onPlaceOrder:G,handleServerError:_,paymentMethodsSlot:t==null?void 0:t.PaymentMethods}),placeOrder:r(ur,{onClick:F??$,handleServerError:_}),shippingAddress:u?void 0:r(d,{name:"ShippingForm",slot:t==null?void 0:t.ShippingForm,children:r(cr,{preselectedFields:l==null?void 0:l.address})}),shippingMethods:u?void 0:r(d,{name:"ShippingMethods",slot:t==null?void 0:t.ShippingMethods,children:r(sr,{preSelectedMethod:l==null?void 0:l.shippingMethod})})}}),W=()=>r(h.Aside,{sections:{cartSummary:r(d,{name:"CartSummary",slot:t==null?void 0:t.CartSummary,children:r(fr,{routeCart:p})}),orderSummary:r(d,{name:"OrderSummary",slot:t==null?void 0:t.OrderSummary,children:r(pr,{})})}});return v(h,{className:m,banner:r(hr,{}),...x,children:[W(),Q()]})};export{Et as Checkout,Ct as OUT_OF_STOCK,Et as default};
//# sourceMappingURL=Checkout.js.map
