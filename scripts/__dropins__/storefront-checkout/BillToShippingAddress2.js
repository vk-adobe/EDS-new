import"@dropins/tools/event-bus.js";import{e as _}from"./transform-shipping-methods.js";import{u as A}from"./countries.js";import{i as x}from"./IsBillToShippingSignal.js";import{s as C}from"./setBillingAddress.js";import{S as I,a as y}from"./BillToShippingAddress.js";import{jsxs as B,jsx as c}from"@dropins/tools/preact-jsx-runtime.js";import{useState as S,useRef as N,useEffect as T}from"@dropins/tools/preact-compat.js";import $ from"./Check.js";import{c as a,u as w}from"./preact-i18n.esm.js";import{I as j}from"./Icon.js";const z=({name:o,value:n,size:i="medium",disabled:s=!1,error:e=!1,label:l="",description:u="",className:h,checked:p,...r})=>{const[t,f]=S(p===void 0?!1:p),d=N(null),g=b=>{var k;(k=r.onChange)==null||k.call(r,b),f(b.currentTarget.checked)},m=b=>{var k;b.key===" "&&(b.preventDefault(),(k=d==null?void 0:d.current)==null||k.click())};return B("label",{className:a(["dropin-checkbox",["dropin-checkbox--disabled",s]]),children:[c("input",{ref:d,name:o,value:n,type:"checkbox",disabled:s,className:a(["dropin-checkbox__checkbox",["dropin-checkbox__checkbox--error",e],h]),...r,onChange:g,checked:t}),c("span",{"aria-checked":t?"true":"false","aria-labelledby":`${o}-label`,"aria-describedby":`${o}-description`,className:a(["dropin-checkbox__box",["dropin-checkbox__box--error",e],["dropin-checkbox__box--disabled",s]]),role:"checkbox",tabIndex:s?-1:0,onKeyDown:m,children:c(j,{className:a(["dropin-checkbox__checkmark"]),source:$,size:"16",stroke:"3"})}),c("div",{id:`${o}-label`,className:a(["dropin-checkbox__label",`dropin-checkbox__label--${i}`,["dropin-checkbox__label--disabled",s]]),children:l}),c("div",{}),c("div",{id:`${o}-description`,role:"note",className:a(["dropin-checkbox__description",`dropin-checkbox__description--${i}`,["dropin-checkbox__description--disabled",s]]),children:u})]})},O=({className:o,isInitialized:n=!0,checked:i=!0,...s})=>{const e=w({title:"Checkout.BillToShippingAddress.title"});return n?c("div",{className:a(["checkout-bill-to-shipping-address",o]),children:c(z,{"data-testid":"bill-to-shipping-checkbox",className:"checkout-bill-to-shipping-address__checkbox",checked:i,name:"checkout-bill-to-shipping-address__checkbox",label:e.title,...s})}):c(F,{})},F=()=>c(I,{className:"bill-to-shipping-address__skeleton",children:c(y,{variant:"row",size:"small"})}),v="is_bill_to_shipping_address";function H(o,n,i){const s=o[i],e=n[i];return s===void 0&&e===void 0||s===null&&e===null?!0:typeof s=="object"&&typeof e=="object"?JSON.stringify(s)===JSON.stringify(e):s===e}function K(o,n,i){return!n&&!i?!0:!n||!i?!1:o.every(s=>{const e=s.code;return H(n,i,e)})}const U=({isBillToShipping:o})=>{var p;const[n,i]=S(!1),{fields:s}=A(),e=_.value.data,l=!!e,u=e==null?void 0:e.billingAddress,h=(p=e==null?void 0:e.shippingAddresses)==null?void 0:p[0];return T(()=>{if(!s)return;const r=localStorage.getItem(v);if(!n&&r){i(!0),o.value={checked:r==="true",setByUser:!1};return}if(!n&&l){i(!0);const t=K(s,u,h);o.value={checked:e!=null&&e.billingAddress?t:o.value.checked,setByUser:!1}}},[u,e==null?void 0:e.billingAddress,s,l,o,n,h]),{isInitialized:n}},W=({children:o,...n})=>{const{data:i}=_.value,s=(i==null?void 0:i.id)||"",e=x.value.checked,{isInitialized:l}=U({isBillToShipping:x});return c(O,{...n,checked:e,isInitialized:l,onChange:h=>{var d;const r=h.target.checked,t=_.value.data,f=!!((d=t==null?void 0:t.shippingAddresses)!=null&&d[0]);if(x.value={checked:r,setByUser:!0},localStorage.setItem(v,r.toString()),l&&r&&f){const g=new AbortController;return C({signal:g.signal,cartId:s,input:{same_as_shipping:!0}}).catch(m=>{console.error(m)}),()=>{g.abort()}}},disabled:_.value.pending})};export{W as B,v as a,K as c};
//# sourceMappingURL=BillToShippingAddress2.js.map
