{"version":3,"file":"BillToShippingAddress2.js","sources":["../../ElsieSDK/packages/elsie/src/components/Checkbox/Checkbox.tsx","../src/components/BillToShippingAddress/BillToShippingAddress.tsx","../src/components/BillToShippingAddress/BillToShippingAddressSkeleton.tsx","../src/containers/BillToShippingAddress/constants.ts","../src/containers/BillToShippingAddress/BillToShippingAddress.tsx"],"sourcesContent":["import { FunctionComponent } from 'preact';\nimport { ChangeEvent, HTMLAttributes, useRef, useState } from 'preact/compat';\nimport { classes } from '@adobe/elsie/lib';\nimport { Check } from '@adobe/elsie/icons';\nimport { Icon } from '@adobe/elsie/components/Icon';\nimport '@adobe/elsie/components/Checkbox/Checkbox.css';\n\nexport interface CheckboxProps\n  extends Omit<HTMLAttributes<HTMLInputElement>, 'size'> {\n  name: string;\n  size?: 'medium' | 'large';\n  disabled?: boolean;\n  error?: boolean;\n  label?: string;\n  description?: string;\n}\n\nexport const Checkbox: FunctionComponent<CheckboxProps> = ({\n  name,\n  value,\n  size = 'medium',\n  disabled = false,\n  error = false,\n  label = '',\n  description = '',\n  className,\n  checked,\n  ...props\n}) => {\n  const [isChecked, setIsChecked] = useState(\n    checked === undefined ? false : checked\n  );\n  const ref = useRef<HTMLInputElement>(null);\n\n  const handleCheckboxChange = (e: ChangeEvent<HTMLInputElement>) => {\n    props.onChange?.(e);\n    setIsChecked(e.currentTarget.checked);\n  };\n\n  const handleOnKeyDown = (e: KeyboardEvent) => {\n    if (e.key === ' ') {\n      e.preventDefault();\n      ref?.current?.click();\n    }\n  };\n\n  return (\n    <label\n      className={classes([\n        'dropin-checkbox',\n        ['dropin-checkbox--disabled', disabled],\n      ])}\n    >\n      <input\n        ref={ref}\n        name={name}\n        value={value}\n        type=\"checkbox\"\n        disabled={disabled}\n        className={classes([\n          'dropin-checkbox__checkbox',\n          ['dropin-checkbox__checkbox--error', error],\n          className,\n        ])}\n        {...props}\n        onChange={handleCheckboxChange}\n        checked={isChecked}\n      />\n      <span\n        aria-checked={isChecked ? 'true' : 'false'}\n        aria-labelledby={`${name}-label`}\n        aria-describedby={`${name}-description`}\n        className={classes([\n          'dropin-checkbox__box',\n          ['dropin-checkbox__box--error', error],\n          ['dropin-checkbox__box--disabled', disabled],\n        ])}\n        role=\"checkbox\"\n        tabIndex={disabled ? -1 : 0}\n        onKeyDown={handleOnKeyDown}\n      >\n        <Icon\n          className={classes(['dropin-checkbox__checkmark'])}\n          source={Check}\n          size=\"16\"\n          stroke=\"3\"\n        />\n      </span>\n      <div\n        id={`${name}-label`}\n        className={classes([\n          'dropin-checkbox__label',\n          `dropin-checkbox__label--${size}`,\n          ['dropin-checkbox__label--disabled', disabled],\n        ])}\n      >\n        {label}\n      </div>\n      <div />\n      <div\n        id={`${name}-description`}\n        role={'note'}\n        className={classes([\n          'dropin-checkbox__description',\n          `dropin-checkbox__description--${size}`,\n          ['dropin-checkbox__description--disabled', disabled],\n        ])}\n      >\n        {description}\n      </div>\n    </label>\n  );\n};\n","import { FunctionComponent } from 'preact';\nimport { classes } from '@adobe/elsie/lib';\nimport { Checkbox, CheckboxProps } from '@adobe/elsie/components';\nimport { BillToShippingAddressSkeleton } from '@/checkout/components/BillToShippingAddress';\nimport '@/checkout/components/BillToShippingAddress/BillToShippingAddress.css';\nimport { useText } from '@adobe/elsie/i18n';\n\nexport interface BillToShippingAddressProps\n  extends Omit<CheckboxProps, 'name' | 'label'> {\n  isInitialized?: boolean;\n}\n\nexport const BillToShippingAddress: FunctionComponent<\n  BillToShippingAddressProps\n> = ({ className, isInitialized = true, checked = true, ...props }) => {\n  const translations = useText({\n    title: 'Checkout.BillToShippingAddress.title',\n  });\n\n  if (!isInitialized) return <BillToShippingAddressSkeleton />;\n\n  return (\n    <div className={classes(['checkout-bill-to-shipping-address', className])}>\n      <Checkbox\n        data-testid=\"bill-to-shipping-checkbox\"\n        className=\"checkout-bill-to-shipping-address__checkbox\"\n        checked={checked}\n        name=\"checkout-bill-to-shipping-address__checkbox\"\n        label={translations.title}\n        {...props}\n      />\n    </div>\n  );\n};\n","import { FunctionComponent } from 'preact';\nimport { Skeleton, SkeletonRow } from '@adobe/elsie/components';\n\nexport const BillToShippingAddressSkeleton: FunctionComponent = () => {\n  return (\n    <Skeleton className=\"bill-to-shipping-address__skeleton\">\n      <SkeletonRow variant=\"row\" size=\"small\" />\n    </Skeleton>\n  );\n};\n","export const BILL_TO_SHIPPING_KEY = 'is_bill_to_shipping_address';\n","import { FormFields, setBillingAddress } from '@/checkout/api';\nimport { BillToShippingAddress as BillToShippingAddressComponent } from '@/checkout/components/BillToShippingAddress';\nimport {\n  IsBillToShipping,\n  cartSignal,\n  isBillToShippingSignal,\n} from '@/checkout/signals';\nimport { Container } from '@adobe/elsie/lib';\nimport { Signal } from '@preact/signals-core';\nimport { useEffect, useState } from 'preact/compat';\nimport { BILL_TO_SHIPPING_KEY } from './constants';\nimport { useAddressFormFields } from '@/checkout/context/address-form-fields';\nimport { CheckboxProps } from '@adobe/elsie/src/components';\nimport {\n  ShippingAddress,\n  BillingAddress,\n} from '@/checkout/data/models/address';\n\ntype Address = BillingAddress | ShippingAddress[];\n\nfunction compareFields(first: Address, second: Address, field: keyof Address) {\n  const firstValue = first[field];\n  const secondValue = second[field];\n\n  if (firstValue === undefined && secondValue === undefined) return true;\n  if (firstValue === null && secondValue === null) return true;\n\n  if (typeof firstValue === 'object' && typeof secondValue === 'object') {\n    return JSON.stringify(firstValue) === JSON.stringify(secondValue);\n  }\n\n  return firstValue === secondValue;\n}\n\nexport function compareAddresses(\n  addressFormFields: FormFields,\n  first: BillingAddress | undefined,\n  second: ShippingAddress | undefined\n) {\n  if (!first && !second) return true;\n  if (!first || !second) return false;\n\n  return addressFormFields.every((field) => {\n    const fieldCode = field.code as keyof Address;\n    return compareFields(first, second, fieldCode);\n  });\n}\n\nconst useInitialState = ({\n  isBillToShipping,\n}: {\n  isBillToShipping: Signal<IsBillToShipping>;\n}) => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const { fields } = useAddressFormFields();\n  const cartData = cartSignal.value.data;\n  const hasCartData = !!cartData;\n  const billingAddress = cartData?.billingAddress;\n  const shippingAddress = cartData?.shippingAddresses?.[0];\n\n  useEffect(() => {\n    if (!fields) return;\n\n    const localIsBillToShipping = localStorage.getItem(BILL_TO_SHIPPING_KEY);\n\n    if (!isInitialized && localIsBillToShipping) {\n      setIsInitialized(true);\n      isBillToShipping.value = {\n        checked: localIsBillToShipping === 'true',\n        setByUser: false,\n      };\n      return;\n    }\n\n    if (!isInitialized && hasCartData) {\n      setIsInitialized(true);\n\n      const isSameShippingAndBilling = compareAddresses(\n        fields,\n        billingAddress,\n        shippingAddress\n      );\n\n      isBillToShipping.value = {\n        checked: cartData?.billingAddress\n          ? isSameShippingAndBilling\n          : isBillToShipping.value.checked,\n        setByUser: false,\n      };\n    }\n  }, [\n    billingAddress,\n    cartData?.billingAddress,\n    fields,\n    hasCartData,\n    isBillToShipping,\n    isInitialized,\n    shippingAddress,\n  ]);\n\n  return { isInitialized };\n};\n\nexport interface BillToShippingAddressProps\n  extends Omit<CheckboxProps, 'name' | 'label'> {}\n\nexport const BillToShippingAddress: Container<BillToShippingAddressProps> = ({\n  children,\n  ...props\n}) => {\n  const { data: cartData } = cartSignal.value;\n  const cartId = cartData?.id || '';\n  const isBillToShipping = isBillToShippingSignal.value.checked;\n\n  const { isInitialized } = useInitialState({\n    isBillToShipping: isBillToShippingSignal,\n  });\n\n  const onChangeHandler = (event: Event) => {\n    const checkbox = event.target as HTMLInputElement;\n    const isChecked = checkbox.checked;\n    const cartData = cartSignal.value.data;\n    const hasShippingAddress = Boolean(cartData?.shippingAddresses?.[0]);\n\n    isBillToShippingSignal.value = { checked: isChecked, setByUser: true };\n\n    localStorage.setItem(BILL_TO_SHIPPING_KEY, isChecked.toString());\n\n    if (isInitialized && isChecked && hasShippingAddress) {\n      const controller = new AbortController();\n\n      setBillingAddress({\n        signal: controller.signal,\n        cartId,\n        input: { same_as_shipping: true },\n      }).catch((error) => {\n        console.error(error);\n      });\n\n      return () => {\n        controller.abort();\n      };\n    }\n  };\n\n  return (\n    <BillToShippingAddressComponent\n      {...props}\n      checked={isBillToShipping}\n      isInitialized={isInitialized}\n      onChange={onChangeHandler}\n      disabled={cartSignal.value.pending}\n    />\n  );\n};\n"],"names":["Checkbox","name","value","size","disabled","error","label","description","className","checked","props","isChecked","setIsChecked","useState","undefined","ref","useRef","handleCheckboxChange","e","onChange","currentTarget","handleOnKeyDown","key","preventDefault","current","click","_jsxs","classes","children","_jsx","type","role","tabIndex","onKeyDown","Icon","source","Check","stroke","id","BillToShippingAddress","isInitialized","translations","useText","title","BillToShippingAddressSkeleton","Skeleton","SkeletonRow","variant","BILL_TO_SHIPPING_KEY","compareFields","first","second","field","firstValue","secondValue","JSON","stringify","compareAddresses","addressFormFields","every","fieldCode","code","useInitialState","isBillToShipping","setIsInitialized","fields","useAddressFormFields","cartData","cartSignal","data","hasCartData","billingAddress","shippingAddress","shippingAddresses","useEffect","localIsBillToShipping","localStorage","getItem","setByUser","isSameShippingAndBilling","cartId","isBillToShippingSignal","BillToShippingAddressComponent","event","target","hasShippingAddress","Boolean","setItem","toString","controller","AbortController","setBillingAddress","signal","input","same_as_shipping","catch","console","abort","pending"],"mappings":"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"}