import{H as N}from"./usePreselectedFields.js";import"@dropins/tools/preact-hooks.js";import{i as L}from"./countries.js";import"@dropins/tools/event-bus.js";import{e as D}from"./transform-shipping-methods.js";import{s as k}from"./SelectedShippingMethodSignal.js";import{S as E,a as g}from"./BillToShippingAddress.js";import{jsxs as m,jsx as r,Fragment as z}from"@dropins/tools/preact-jsx-runtime.js";import{C as A,P as I}from"./ProgressSpinner.js";import{c as d,T as n}from"./preact-i18n.esm.js";import{D as v}from"./Divider.js";import{P as y}from"./Price.js";const P=({className:o,summary:p,isLoading:t=!1,...T})=>{const{total:u,subtotal:h,shipping:s,tax:c}=p;return m(A,{...T,className:d(["checkout-order-summary",["checkout-order-summary--loading",t],o]),children:[r(N,{level:2,className:"checkout-order-summary__title",children:r(n,{id:"Checkout.OrderSummary.title"})}),r(v,{variant:"primary"}),t&&r(I,{className:"checkout-order-summary__spinner"}),m("div",{"data-testid":"order-summary-subtotal",className:"checkout-order-summary__row",children:[r("p",{children:r(n,{id:"Checkout.OrderSummary.subtotal"})}),r(y,{amount:h.amount,currency:h.currency,className:d(["checkout-order-summary__price",o])})]}),h.isTaxIncl&&r("div",{"data-testid":"order-summary-subtotal-incl-tax",className:"checkout-order-summary__row checkout-order-summary__row--muted",children:r("p",{children:r(n,{id:"Checkout.OrderSummary.includingTaxes"})})}),s!=null&&m("div",{"data-testid":"order-summary-shipping",className:"checkout-order-summary__row",children:[r("p",{"data-testid":"order-summary-shipping-label",children:s.isEstimated?r(n,{id:"Checkout.OrderSummary.estimatedShipping"}):r(n,{id:"Checkout.OrderSummary.shipping"})}),s.amount===0?r("p",{"data-testid":"estimated-shipping",className:"checkout-order-summary__price",children:r(n,{id:"Checkout.OrderSummary.freeShipping"})}):r(y,{"data-testid":"estimated-shipping",amount:s.amount,currency:s.currency,className:d(["checkout-order-summary__price",o])})]}),c!=null&&!c.breakdown&&m("div",{"data-testid":"order-summary-tax",className:"checkout-order-summary__row",children:[r("p",{children:r(n,{id:"Checkout.OrderSummary.tax"})}),r(y,{amount:c.amount,currency:c.currency,className:d(["checkout-order-summary__price",o])})]}),c!=null&&c.breakdown&&m(z,{children:[r(v,{variant:"secondary"}),r("div",{className:"checkout-order-summary__row checkout-order-summary__row--margin-bottom",children:r("p",{children:r(n,{id:"Checkout.OrderSummary.taxBreakdown"})})}),c.breakdown.map(e=>m("div",{"data-testid":"order-summary-tax-breakdown",className:"checkout-order-summary__row checkout-order-summary__row--muted",children:[r("p",{children:e.label}),r(y,{amount:e.amount.value,currency:e.amount.currency,className:d(["checkout-order-summary__price",o])})]},e.label)),m("div",{"data-testid":"order-summary-tax-breakdown-total",className:"checkout-order-summary__row checkout-order-summary__row--strong checkout-order-summary__row--margin-top",children:[r("p",{children:r(n,{id:"Checkout.OrderSummary.taxTotal"})}),r(y,{amount:c.amount,currency:c.currency,className:d(["checkout-order-summary__price",o])})]}),r(v,{variant:"secondary"})]}),m("div",{"data-testid":"order-summary-total-incl-tax",className:"checkout-order-summary__row checkout-order-summary__row--emphasized",children:[r("p",{children:r(n,{id:"Checkout.OrderSummary.total"})}),r(y,{amount:u.inclTax.amount,currency:u.inclTax.currency,className:d(["checkout-order-summary__price",o])})]}),u.exclTax!=null&&m("div",{"data-testid":"order-summary-total-excl-tax",className:"checkout-order-summary__row checkout-order-summary__row--muted",children:[r("p",{children:r(n,{id:"Checkout.OrderSummary.totalExclTax"})}),r(y,{amount:u.exclTax.amount,currency:u.exclTax.currency,className:d(["checkout-order-summary__price",o])})]})]})},j=()=>m(E,{"data-testid":"order-summary-skeleton",className:"order-summary__skeleton",children:[r(g,{variant:"heading",size:"medium"}),r(g,{variant:"empty",size:"medium"}),r(g,{size:"large",fullWidth:!0,lines:3})]}),w=0,F=2,G={isLoading:!0};function H(){const{config:o}=L(),p=o===void 0,t=D.value.data;if(p||t===void 0)return G;const u=o.taxCartDisplay,h=u.shoppingCartDisplaySubtotal===F,s=t==null?void 0:t.shippingAddresses,c=!!(s!=null&&s.length),e=t==null?void 0:t.prices,x=e==null?void 0:e.grand_total,C=!!x,f=h?e==null?void 0:e.subtotal_including_tax:e==null?void 0:e.subtotal_excluding_tax,_=(e==null?void 0:e.applied_taxes)||[],S=!!_.length;if(!C)return{isLoading:!1};const a={total:{inclTax:{amount:x.value,currency:x.currency}},subtotal:{amount:f.value,currency:f.currency,isTaxIncl:h}};if(S){const l=_.reduce((b,O)=>b+O.amount.value,w),i=_[0];a.tax={amount:l,currency:i.amount.currency},u.shoppingCartDisplayFullSummary&&(a.tax.breakdown=_)}if(!S&&u.shoppingCartDisplayZeroTax&&(a.tax={amount:w,currency:a.total.inclTax.currency}),u.shoppingCartDisplayGrandTotal){const l=a.tax?a.total.inclTax.amount-a.tax.amount:a.total.inclTax.amount;a.total.exclTax={amount:l,currency:a.total.inclTax.currency}}if(c){const l=s[0],i=l==null?void 0:l.selectedShippingMethod;return i?(a.shipping={amount:i==null?void 0:i.amount.value,currency:i==null?void 0:i.amount.currency,isEstimated:!1},{isLoading:!1,summary:a}):{isLoading:!1,summary:a}}return k.value?(a.shipping={amount:k.value.amount.value,currency:k.value.amount.currency,isEstimated:!0},a.total.inclTax.amount+=a.shipping.amount,a.total.exclTax&&(a.total.exclTax.amount+=a.shipping.amount),{isLoading:!1,summary:a}):{isLoading:!1,summary:a}}const V=({...o})=>{const{isLoading:p,summary:t}=H();return m("div",{...o,children:[!t&&r(j,{}),t&&r(P,{isLoading:p,summary:t})]})};export{V as O,H as u};
//# sourceMappingURL=OrderSummary.js.map
