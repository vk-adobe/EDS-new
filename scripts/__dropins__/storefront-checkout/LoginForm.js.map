{"version":3,"file":"LoginForm.js","sources":["../src/components/LoginForm/Email.tsx","../src/components/LoginForm/SignIn.tsx","../src/components/LoginForm/LoginForm.tsx","../src/containers/LoginForm/LoginForm.tsx"],"sourcesContent":["import { Field, Input } from '@adobe/elsie/components';\nimport { useText } from '@adobe/elsie/i18n';\nimport { HTMLAttributes } from 'preact/compat';\nimport { FunctionComponent } from 'preact';\n\nexport interface LoginEmailProps extends HTMLAttributes<HTMLFormElement> {\n  value?: string;\n  error?: string;\n  hint?: string;\n  onChange: (e: any) => void;\n  onBlur: (e: any) => void;\n  onInvalid: (e: any) => void;\n}\n\nexport const Email: FunctionComponent<LoginEmailProps> = ({\n  value,\n  error,\n  hint,\n  onChange,\n  onBlur,\n  onInvalid,\n}) => {\n  const translations = useText({\n    LoginFormLabel: 'Checkout.LoginForm.ariaLabel',\n    LoginFormFloatingLabel: 'Checkout.LoginForm.floatingLabel',\n    LoginFormPlaceholder: 'Checkout.LoginForm.placeholder',\n  });\n\n  return (\n    <Field size=\"medium\" error={error} hint={hint}>\n      <Input\n        id=\"customer-email\"\n        name=\"userName\"\n        type=\"email\"\n        value={value}\n        autocomplete=\"email\"\n        placeholder={translations.LoginFormPlaceholder}\n        floatingLabel={translations.LoginFormFloatingLabel}\n        onChange={onChange}\n        onBlur={onBlur}\n        onInvalid={onInvalid}\n        required={true}\n        aria-label={translations.LoginFormLabel}\n        aria-required={true}\n      />\n    </Field>\n  );\n};\n","import { FunctionComponent } from 'preact';\nimport { Text } from '@adobe/elsie/i18n';\n\nexport interface LoginSignInProps {}\n\nexport const SignIn: FunctionComponent<LoginSignInProps> = () => {\n  return (\n    <p className=\"checkout-login-form__signIn\">\n      <Text id=\"Checkout.LoginForm.account\" />\n\n      <a\n        className=\"checkout-login-form__link\"\n        href=\"#\"\n        target=\"_blank\"\n        rel=\"noreferrer\"\n      >\n        <Text id=\"Checkout.LoginForm.signIn\" />\n      </a>\n    </p>\n  );\n};\n","import { Email, Heading, SignIn } from '@/checkout/components';\nimport '@/checkout/components/LoginForm/LoginForm.css';\nimport { useText } from '@adobe/elsie/i18n';\nimport { classes } from '@adobe/elsie/lib';\nimport { FunctionComponent, HTMLAttributes } from 'preact/compat';\n\nexport interface LoginFormProps extends HTMLAttributes<HTMLDivElement> {\n  currentEmail?: string | null;\n  hint?: string;\n  error?: string | null;\n  onEmailChange: (e: any) => void;\n  onEmailBlur: (e: any) => void;\n  onEmailInvalid: (e: any) => void;\n}\n\nexport const LoginForm: FunctionComponent<LoginFormProps> = ({\n  name,\n  className,\n  currentEmail,\n  hint,\n  error = null,\n  onEmailChange,\n  onEmailBlur,\n  onEmailInvalid,\n  ...props\n}) => {\n  const translations = useText({\n    Title: 'Checkout.LoginForm.title',\n  });\n\n  return (\n    <div {...props} className={classes(['checkout-login-form', className])}>\n      <div className=\"checkout-login-form__heading\">\n        <Heading level={2} className=\"checkout-login-form__title\">\n          {translations.Title}\n        </Heading>\n        <SignIn />\n      </div>\n      <div className=\"checkout-login-form__content\">\n        <form\n          className={classes(['dropin-login-form__form', className])}\n          name={name}\n          noValidate\n        >\n          {/* Prevent 'Enter' key press from submitting this form. */}\n          <button\n            type=\"submit\"\n            disabled\n            style=\"display: none\"\n            aria-hidden=\"true\"\n          />\n          <Email\n            value={currentEmail || undefined}\n            error={error || ''}\n            hint={hint}\n            onChange={onEmailChange}\n            onBlur={onEmailBlur}\n            onInvalid={onEmailInvalid}\n          />\n        </form>\n      </div>\n    </div>\n  );\n};\n","import { isEmailAvailable, setGuestEmailOnCart } from '@/checkout/api';\nimport { LoginForm as LoginFormComponent } from '@/checkout/components/LoginForm';\nimport { useText } from '@adobe/elsie/i18n';\nimport { HTMLAttributes } from 'preact/compat';\nimport { useEffect, useState } from 'preact/hooks';\nimport { LOGIN_FORM_NAME } from './constants';\nimport { cartSignal } from '@/checkout/signals';\nimport { FunctionComponent } from 'preact';\n\nexport interface LoginFormProps extends HTMLAttributes<HTMLDivElement> {\n  email?: string;\n}\n\nconst DEBOUNCE_TIME = 1000;\n\nexport const LoginForm: FunctionComponent<LoginFormProps> = ({\n  className,\n  email = null,\n  ...props\n}) => {\n  const translations = useText({\n    LoginFormInvalidEmailError: 'Checkout.LoginForm.invalidEmailError',\n    LoginFormMissingEmailError: 'Checkout.LoginForm.missingEmailError',\n    LoginFormEmailExists: 'Checkout.LoginForm.emailExists',\n  });\n\n  const { data: cartData } = cartSignal.value;\n  const cartId = cartData?.id || '';\n  const hasCartData = !!cartData;\n\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [currentEmail, setCurrentEmail] = useState<string | null>(email);\n  const [error, setError] = useState<string | null>();\n  const [emailAvailability, setEmailAvailability] = useState<boolean>(true);\n\n  const errorMessage = (validity: ValidityState): string | null => {\n    if (validity.valid) return null;\n    if (validity.valueMissing) return translations.LoginFormMissingEmailError;\n    return translations.LoginFormInvalidEmailError;\n  };\n\n  const onEmailChange = (e: any) => {\n    const { value } = e.target as HTMLInputElement;\n    setCurrentEmail(value);\n    setError(null);\n    setEmailAvailability(true);\n  };\n\n  const onEmailBlur = (e: any) => {\n    const { validity } = e.target as HTMLInputElement;\n    setError(errorMessage(validity));\n  };\n\n  const onEmailInvalid = (e: any) => {\n    const { validity } = e.target as HTMLInputElement;\n    setError(errorMessage(validity));\n  };\n\n  if (!isInitialized && hasCartData) {\n    setIsInitialized(true);\n    setCurrentEmail(cartData?.email || email);\n  }\n\n  useEffect(() => {\n    if (!currentEmail || error || cartData?.email === currentEmail) return;\n\n    const timer = setTimeout(() => {\n      isEmailAvailable(currentEmail)\n        .then((result) => {\n          setEmailAvailability(result);\n\n          setGuestEmailOnCart({\n            cartId,\n            email: currentEmail,\n          }).catch((e: any) => {\n            console.log('set email failed', e);\n          });\n        })\n        .catch((e: any) => {\n          // TODO: handle error state\n          console.log(e);\n          setError(translations.LoginFormInvalidEmailError);\n          setEmailAvailability(true);\n        });\n    }, DEBOUNCE_TIME);\n\n    return () => {\n      timer && clearTimeout(timer);\n    };\n  }, [\n    currentEmail,\n    error,\n    translations.LoginFormInvalidEmailError,\n    cartData?.email,\n    cartId,\n  ]);\n\n  return (\n    <LoginFormComponent\n      className={className}\n      currentEmail={currentEmail}\n      error={error}\n      hint={emailAvailability ? '' : translations.LoginFormEmailExists}\n      name={LOGIN_FORM_NAME}\n      onEmailBlur={onEmailBlur}\n      onEmailChange={onEmailChange}\n      onEmailInvalid={onEmailInvalid}\n      {...props}\n    />\n  );\n};\n"],"names":["Email","value","error","hint","onChange","onBlur","onInvalid","translations","useText","LoginFormLabel","LoginFormFloatingLabel","LoginFormPlaceholder","_jsx","Field","size","children","Input","id","name","type","autocomplete","placeholder","floatingLabel","required","SignIn","_jsxs","className","Text","href","target","rel","LoginForm","currentEmail","onEmailChange","onEmailBlur","onEmailInvalid","props","Title","classes","Heading","level","noValidate","disabled","style","undefined","DEBOUNCE_TIME","email","LoginFormInvalidEmailError","LoginFormMissingEmailError","LoginFormEmailExists","data","cartData","cartSignal","cartId","hasCartData","isInitialized","setIsInitialized","useState","setCurrentEmail","setError","emailAvailability","setEmailAvailability","errorMessage","validity","valid","valueMissing","e","useEffect","timer","setTimeout","then","result","setGuestEmailOnCart","catch","log","console","clearTimeout","LoginFormComponent","LOGIN_FORM_NAME"],"mappings":"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"}