const __vite__fileDeps=["debugger.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import"@dropins/tools/event-bus.js";import{e as W}from"./transform-shipping-methods.js";import"./countries.js";import{s as D}from"./setPaymentMethod.js";import{H as J}from"./usePreselectedFields.js";import{useEffect as E,useRef as T,useState as B,useMemo as x,useContext as F,useCallback as M}from"@dropins/tools/preact-hooks.js";import{S as G,a as v}from"./BillToShippingAddress.js";import{jsx as a,jsxs as C,Fragment as K}from"@dropins/tools/preact-jsx-runtime.js";import{I as Q,u as X,c as b}from"./preact-i18n.esm.js";import{I as Y,R as Z}from"./IllustratedMessage.js";import ee from"./Wallet.js";import{_ as te,I as ne}from"./Icon.js";import{P as oe}from"./ProgressSpinner.js";import{useRef as se,useState as N,useCallback as O,useEffect as $}from"@dropins/tools/preact-compat.js";function re(t={},s,o){const r=T(null),d=T(!1),u=T([]),[l,h]=B({children:[o==null?void 0:o({})]}),[g,y]=B({}),w=x(()=>({get:e=>g[e],set:(e,n)=>{y({...w,[e]:n})}}),[g]),{intl:I}=F(Q);t.dictionary=I.dictionary,t._setProps=h;const m=M(e=>{typeof e=="function"?u.current.push(e):console.warn("Skipped: Invalid _registerMethod",e)},[]);t._registerMethod=m;const S=M(e=>a("div",{"data-slot-html-element":e.tagName.toLowerCase(),ref:n=>{n==null||n.appendChild(e)}}),[]);return t._htmlElementToVNode=S,t.getSlotElement=M(e=>{const n=document.querySelector(`[data-slot-key="${e}"]`);if(n)return{appendChild:i=>{n.appendChild(i)},prependChild:i=>{n.insertBefore(i,n.firstChild)},appendSibling:i=>{const c=n.parentNode;c==null||c.insertBefore(i,n.nextSibling)},prependSibling:i=>{const c=n.parentNode;c==null||c.insertBefore(i,n)}}},[]),t.onChange=M(e=>{u.current.push(e)},[]),t.replaceWith=M(e=>{m(n=>{const i=S(e);n._setProps({children:[i]})})},[S,m]),t.appendChild=M(e=>{m(n=>{const i=S(e);n._setProps(c=>({...c,children:[...c.children,i]}))})},[S,m]),t.prependChild=M(e=>{m(n=>{const i=S(e);n._setProps(c=>({...c,children:[i,...c.children]}))})},[S,m]),t.appendSibling=M(e=>{m(()=>{var i,c;const n=(i=r.current)==null?void 0:i.parentNode;n==null||n.insertBefore(e,((c=r.current)==null?void 0:c.nextSibling)??null)})},[m]),t.prependSibling=M(e=>{m(()=>{var i;const n=(i=r.current)==null?void 0:i.parentNode;n==null||n.insertBefore(e,r.current)})},[m]),E(()=>{const e=r.current;if(!(!s||!e))try{s(t,e)}catch(n){console.error(`Error in "${s.name}" Slot callback`,n)}},[]),E(()=>{h({children:[o==null?void 0:o(l)]}),u.current.forEach(e=>{e(t,w)}),(o==null?void 0:o.name)==="render"&&d.current===!1&&(d.current=!0)},[JSON.stringify(t),JSON.stringify(g),d.current]),[r,l]}function A({name:t,slot:s,context:o,children:r,render:d,...u}){const[l,h]=re(o,s,d??(()=>r));return E(()=>{t||console.warn('Slot "name" is required')},[t]),a("div",{...u,ref:l,"data-slot":t,children:h.children})}window.DROPINS=window.DROPINS||{};window.DROPINS.showSlots=async t=>{if(window.sessionStorage.setItem("dropin-debugger--show-slots",t.toString()),document.body.classList.toggle("dropin-debugger--show-slots",t),t)try{await te(()=>Promise.resolve({}),__vite__mapDeps([0]))}catch{}};window.DROPINS.showSlots(window.sessionStorage.getItem("dropin-debugger--show-slots")==="true");const ae=({code:t,isLoading:s,isSelected:o,onChange:r,title:d})=>a(ce,{className:"checkout-payment-methods__method",label:d,name:"payment-method",value:t,selected:o,onChange:r,radioButtonProps:{"aria-busy":s}}),de=({className:t,paymentMethodContent:s,isLoading:o,onChange:r=()=>{},options:d,selection:u})=>{const l=X({Title:"Checkout.PaymentMethods.title",EmptyState:"Checkout.PaymentMethods.emptyState"});return d===void 0?a(ie,{}):C("div",{className:b(["checkout-payment-methods",t]),children:[a(J,{level:2,className:"checkout-payment-methods__title",children:l.Title}),!o&&d.length===0&&a(Y,{icon:a(ne,{source:ee}),message:a("p",{children:l.EmptyState})}),C("div",{className:b(["checkout-payment-methods__wrapper"]),children:[o&&a(oe,{className:"checkout-payment-methods__spinner"}),a("div",{className:b(["checkout-payment-methods__methods",["checkout-payment-methods--loading",o],["checkout-payment-methods--full-width",d.length%2!==0]]),children:d==null?void 0:d.map(h=>a(ae,{code:h.code,onChange:r,isSelected:h.code===u,title:h.title},h.code))}),s&&a("div",{className:"checkout-payment-methods__content",children:s})]})]})},ie=()=>C(G,{"data-testid":"payment-methods-skeleton",children:[a(v,{variant:"heading",size:"medium"}),a(v,{variant:"empty",size:"medium"}),a(v,{size:"xlarge",fullWidth:!0}),a(v,{size:"xlarge",fullWidth:!0})]}),ce=({label:t,name:s,value:o,icon:r,selected:d,onChange:u,className:l,children:h,radioButtonProps:g,...y})=>a("div",{className:b(["checkout-toggle-button",l,["checkout-toggle-button__selected",d]]),...y,children:C("label",{className:"checkout-toggle-button__actionButton",children:[a(Z,{...g,label:"",name:s,value:o,checked:d,onChange:()=>u(o),"aria-label":t,className:b([l,"checkout-toggle-button__radioButton"])}),C("div",{className:"checkout-toggle-button__content",children:[r&&a(r.type,{...r==null?void 0:r.props,className:"checkout-toggle-button__icon"}),t]})]})}),L={free:{render:t=>{const s=document.createElement("div");s.innerText="",t.replaceHTML(s)}},checkmo:{render:t=>{const s=document.createElement("div");s.innerText="",t.replaceHTML(s)}}};function le(t){var H;const{onPlaceOrder:s,handleServerError:o,paymentMethodsSlot:r,isShippingInfoRequired:d}=t,u=se(),[l,h]=N(),[g,y]=N(),[w,I]=N(L),[m,S]=N(!0),{data:e}=W.value,n=(e==null?void 0:e.id)??"",i=!!e,c=!!((H=e==null?void 0:e.shippingAddresses)!=null&&H[0]),f=e==null?void 0:e.availablePaymentMethods,P=e==null?void 0:e.selectedPaymentMethod,k=O(async p=>{try{if(h(p),!c&&d)return;const _=p;if(_===u.current)return;u.current=_,await D({cartId:n,paymentMethod:p})}catch(_){console.error("setting payment method failed:",_)}},[n,c,d]);$(()=>{i&&(P!=null&&P.code?(f==null?void 0:f.some(_=>_.code===P.code))?h(P.code):f!=null&&f.length?k(f[0].code):h(void 0):f[0]&&k(g||f[0].code))},[f,i,P,k,g]);const q=async p=>{await k(p),P!=null&&P.code||y(p)},z=O((p,_)=>{if(!p){console.warn("Payment method handler is ignored because it has no code");return}if(!_){console.warn("Payment method handler is ignored because it is empty");return}I(j=>({...j,[p]:_}))},[]),U=r?a(A,{name:"PaymentMethods",slot:r,context:{addPaymentMethodHandler:z,replaceHTML(p){this.replaceWith(p),S(!1)}}}):null,R=l?w[l]:null,V=R?a(A,{name:"PaymentMethodContent",slot:R.render,context:{cartId:n,onPlaceOrder:s,handleServerError:o,replaceHTML(p){this.replaceWith(p)}}},R):void 0;return $(()=>{!m&&w!=L&&console.warn("Payment method handlers you have added are ignored because the default content has been replaced")},[m,w]),{availablePaymentMethods:f,selectedPaymentMethod:l,onPaymentMethodChange:q,paymentMethodContent:V,mainSlotContent:U,isDefaultContentUsed:m}}const ke=t=>{const{onPlaceOrder:s,handleServerError:o,paymentMethodsSlot:r,isShippingInfoRequired:d=!0}=t,{availablePaymentMethods:u,selectedPaymentMethod:l,onPaymentMethodChange:h,paymentMethodContent:g,mainSlotContent:y,isDefaultContentUsed:w}=le({onPlaceOrder:s,handleServerError:o,paymentMethodsSlot:r,isShippingInfoRequired:d});return C(K,{children:[y&&a(y.type,{ref:y.ref,...y.props}),w&&a(de,{options:u,selection:l,onChange:h,paymentMethodContent:g,isLoading:W.value.pending})]})};export{ke as P,A as S};
//# sourceMappingURL=PaymentMethods.js.map
