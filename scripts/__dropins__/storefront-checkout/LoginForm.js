import"@dropins/tools/event-bus.js";import{e as T}from"./transform-shipping-methods.js";import"./countries.js";import{i as y,s as M}from"./setGuestEmailOnCart.js";import{jsx as r,jsxs as d}from"@dropins/tools/preact-jsx-runtime.js";import{F as A,I as O,H as z}from"./usePreselectedFields.js";import{useState as g,useEffect as B}from"@dropins/tools/preact-hooks.js";import"./BillToShippingAddress.js";import{u as f,T as k,c as I}from"./preact-i18n.esm.js";import{L as S}from"./constants2.js";const j=({value:m,error:t,hint:c,onChange:e,onBlur:o,onInvalid:s})=>{const a=f({LoginFormLabel:"Checkout.LoginForm.ariaLabel",LoginFormFloatingLabel:"Checkout.LoginForm.floatingLabel",LoginFormPlaceholder:"Checkout.LoginForm.placeholder"});return r(A,{size:"medium",error:t,hint:c,children:r(O,{id:"customer-email",name:"userName",type:"email",value:m,autocomplete:"email",placeholder:a.LoginFormPlaceholder,floatingLabel:a.LoginFormFloatingLabel,onChange:e,onBlur:o,onInvalid:s,required:!0,"aria-label":a.LoginFormLabel,"aria-required":!0})})},q=()=>d("p",{className:"checkout-login-form__signIn",children:[r(k,{id:"Checkout.LoginForm.account"}),r("a",{className:"checkout-login-form__link",href:"#",target:"_blank",rel:"noreferrer",children:r(k,{id:"Checkout.LoginForm.signIn"})})]}),G=({name:m,className:t,currentEmail:c,hint:e,error:o=null,onEmailChange:s,onEmailBlur:a,onEmailInvalid:h,...E})=>{const l=f({Title:"Checkout.LoginForm.title"});return d("div",{...E,className:I(["checkout-login-form",t]),children:[d("div",{className:"checkout-login-form__heading",children:[r(z,{level:2,className:"checkout-login-form__title",children:l.Title}),r(q,{})]}),r("div",{className:"checkout-login-form__content",children:d("form",{className:I(["dropin-login-form__form",t]),name:m,noValidate:!0,children:[r("button",{type:"submit",disabled:!0,style:"display: none","aria-hidden":"true"}),r(j,{value:c||void 0,error:o||"",hint:e,onChange:s,onBlur:a,onInvalid:h})]})})]})},H=1e3,X=({className:m,email:t=null,...c})=>{const e=f({LoginFormInvalidEmailError:"Checkout.LoginForm.invalidEmailError",LoginFormMissingEmailError:"Checkout.LoginForm.missingEmailError",LoginFormEmailExists:"Checkout.LoginForm.emailExists"}),{data:o}=T.value,s=(o==null?void 0:o.id)||"",a=!!o,[h,E]=g(!1),[l,v]=g(t),[L,u]=g(),[_,F]=g(!0),p=i=>i.valid?null:i.valueMissing?e.LoginFormMissingEmailError:e.LoginFormInvalidEmailError,b=i=>{const{value:n}=i.target;v(n),u(null),F(!0)},C=i=>{const{validity:n}=i.target;u(p(n))},N=i=>{const{validity:n}=i.target;u(p(n))};return!h&&a&&(E(!0),v((o==null?void 0:o.email)||t)),B(()=>{if(!l||L||(o==null?void 0:o.email)===l)return;const i=setTimeout(()=>{y(l).then(n=>{F(n),M({cartId:s,email:l}).catch(x=>{console.log("set email failed",x)})}).catch(n=>{console.log(n),u(e.LoginFormInvalidEmailError),F(!0)})},H);return()=>{i&&clearTimeout(i)}},[l,L,e.LoginFormInvalidEmailError,o==null?void 0:o.email,s]),r(G,{className:m,currentEmail:l,error:L,hint:_?"":e.LoginFormEmailExists,name:S,onEmailBlur:C,onEmailChange:b,onEmailInvalid:N,...c})};export{X as L};
//# sourceMappingURL=LoginForm.js.map
