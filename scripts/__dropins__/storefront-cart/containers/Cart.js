import{useState as w,useEffect as K,useRef as te,useCallback as ne}from"@dropins/tools/preact-compat.js";import{events as se}from"@dropins/tools/event-bus.js";import{d as ce,I as j,A as q,M as ee,D as G,S as oe,a as de,P as W,B as J,E as le,C as pe,b as me,c as X}from"../MiniCart.js";import{jsxs as l,jsx as e,Fragment as L}from"@dropins/tools/preact-jsx-runtime.js";import{c as a,V as C,u as H,T}from"../UIProvider.js";import{s as ue,n as he}from"../getStoreConfig.js";import{b as _e,u as ye}from"../updateProductsFromCart.js";import{g as ge,a as xe,b as ve}from"../getEstimateShipping.js";import ie from"../ChevronDown.js";import Ne from"../ChevronUp.js";import{useCallback as Se,useRef as be}from"@dropins/tools/preact-hooks.js";import fe from"../WarningWithCircle.js";import ke from"../CheckWithCircle.js";import"@dropins/tools/preact.js";import"@dropins/tools/fetch-graphql.js";const Ce=x=>{const m=new FormData(x);return Object.fromEntries(m)},Y=({name:x,value:m,variant:s="primary",className:h,disabled:c,error:d,floatingLabel:r,onValue:n,onUpdateError:_,size:P="medium",icon:o,maxLength:u,success:N,...S})=>{const b=(S==null?void 0:S.id)||x||`dropin-input-${Math.random().toString(36)}`,y=Se(ce(async f=>{if(n)try{await n(f)}catch(k){_&&_(k)}},200),[n,_]),z=f=>{const k=f.target;y(k.value.trim())};return l("div",{className:a(["dropin-input-container",`dropin-input-container--${s}`,["dropin-input-container--floating",!!r],["dropin-input-container--disabled",c]]),children:[o&&e(C,{node:o,className:a(["dropin-input__field-icon--left",o.props.className])}),l("div",{className:"dropin-input-label-container",children:[e("input",{id:b,onChange:z,type:"text",maxLength:u,name:x,value:m,...S,className:a(["dropin-input",`dropin-input--${P}`,`dropin-input--${s}`,["dropin-input--error",!!d],["dropin-input--success",!!N],["dropin-input--disabled",c],["dropin-input--floating",!!r],["dropin-input--icon-left",!!o],h]),disabled:c}),r&&e("label",{htmlFor:b,className:a([["dropin-input__label--floating",!!r],["dropin-input__label--floating--icon-left",!!o],["dropin-input__label--floating--error",!!d]]),children:r})]}),d&&e("div",{className:a(["dropin-input__field-icon--right","dropin-input__field-icon--error"]),children:e(j,{source:fe,size:"16",stroke:"2",className:"dropin-input--warning-icon",viewBox:"-1 -1 26 26"})}),N&&e("div",{className:a(["dropin-input__field-icon--right","dropin-input__field-icon--success"]),children:e(j,{source:ke,size:"16",stroke:"2",className:"dropin-input--success-icon",viewBox:"-1 -1 26 26"})})]})},O=({name:x,value:m=null,options:s,variant:h="primary",floatingLabel:c,size:d="medium",handleSelect:r=()=>{},disabled:n=!1,error:_=!1,placeholder:P,defaultOption:o,icon:u,className:N,...S})=>{var D;const b=(S==null?void 0:S.id)||x||`dropin-picker-${Math.random().toString(36)}`,y=s==null?void 0:s.find(t=>!t.disabled),[z,f]=w({value:m,text:(o==null?void 0:o.text)||P||(y==null?void 0:y.text),icon:u});K(()=>{const t=s==null?void 0:s.find(I=>I.value===m);f(t??{value:(o==null?void 0:o.value)||(P||c?null:y==null?void 0:y.value),text:(o==null?void 0:o.text)||P||(y==null?void 0:y.text),icon:u})},[m,s,P,u,o,c]);const k=t=>{const{options:I,value:B}=t.target;for(const A of I)A.selected&&(f({value:B,text:A.text,icon:u}),r(t))},R=s==null?void 0:s.map(t=>{const{value:I,text:B,disabled:A}=t,V=I===z.value;return e("option",{value:I,selected:V,disabled:A,className:a(["dropin-picker__option"]),children:B},I)}),g=be(null),v=!((D=g.current)!=null&&D.selected)||!!o;return l("div",{className:a([N,"dropin-picker",`dropin-picker__${d}`,["dropin-picker__floating",!!c],["dropin-picker__selected",v],["dropin-picker__error",_],["dropin-picker__disabled",n],["dropin-picker__icon",u]]),children:[u&&e(u.type,{...u.props,className:"dropin-picker__icon--placeholder"}),l("select",{id:b,className:a(["dropin-picker__select",`dropin-picker__select--${h}`,`dropin-picker__select--${d}`,["dropin-picker__select--floating",!!c]]),name:x,"aria-label":x,disabled:n,onChange:k,...S,children:[!o&&(c||P)&&e("option",{value:"",ref:g,className:a(["dropin-picker__option dropin-picker__placeholder"]),children:c??P},m),R]}),e(j,{source:ie,size:"24",stroke:"2",className:"dropin-picker__chevronDown"}),c&&v&&e("label",{htmlFor:b,className:a(["dropin-picker__floatingLabel",!!c]),children:c})]})},re=({className:x,children:m,title:s,secondaryText:h,actionIconPosition:c="left",iconOpen:d=q,iconClose:r=ee,iconLeft:n=q,showIconLeft:_=!1,renderContentWhenClosed:P=!0,onStateChange:o,...u})=>{const[N,S]=w(!1),b=R=>{R.stopImmediatePropagation();const g=!N;S(g),o==null||o(g)},y=H(`Dropin.Accordion.${N?"close":"open"}.label`).label,z=e(j,{source:d,size:"24",onClick:b,onKeyPress:b,className:"dropin-accordion-section__open-icon"}),f=e(j,{source:r,size:"24",onClick:b,onKeyPress:b,className:"dropin-accordion-section__close-icon"}),k=e(j,{source:n,size:"24"});return l("div",{...u,className:a(["dropin-accordion-section",x]),children:[l("div",{className:"dropin-accordion-section__heading",children:[e("div",{className:"dropin-accordion-section__flex",onClick:b,onKeyPress:b,role:"button","aria-label":`${y} ${s}`,tabIndex:0,children:l("div",{className:"dropin-accordion-section__title-container",children:[c==="left"&&(N?f:z),_&&k,e("h3",{className:"dropin-accordion-section__title",children:s})]})}),l("div",{className:"dropin-accordion-section__secondary-text-container",children:[h&&e("h4",{className:"dropin-accordion-section__secondary-text",children:h}),c==="right"&&(N?f:z)]})]}),e("div",{className:"dropin-accordion-section__content-container",style:{display:N?"grid":"none"},children:(N||P&&!N)&&m})]})},Pe=({className:x,children:m,actionIconPosition:s="left",iconOpen:h=q,iconClose:c=ee,...d})=>{const r=e(G,{variant:"secondary"}),n=_=>l(L,{children:[e(re,{..._.props,actionIconPosition:s,iconOpen:h,iconClose:c}),r]});return e("div",{...d,className:a(["dropin-accordion",x]),children:[r,...(Array.isArray(m)?m:[m]).map(n)]})},De=({className:x,children:m,...s})=>{const{heading:h,loading:c=!0,total:d,subTotal:r,shipping:n,taxTotal:_,taxesApplied:P,discounts:o,primaryAction:u,...N}=s,[S,b]=w(!1),y=te(null),[z,f]=w(!0),[k,R]=w("zip"),g=H({editZipAction:"Dropin.PriceSummary.shipping.editZipAction",destinationLinkAriaLabel:"Dropin.PriceSummary.shipping.destinationLinkAriaLabel",taxesBreakdownTitle:"Dropin.PriceSummary.taxes.breakdown",subtotalLabel:"Dropin.PriceSummary.subTotal.label",shippingLabel:"Dropin.PriceSummary.shipping.label",showTaxBreakdown:"Dropin.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Dropin.PriceSummary.taxes.hideBreakdown",zipPlaceholder:"Dropin.PriceSummary.shipping.zipPlaceholder"}),v=p=>{p.preventDefault(),f(E=>!E)},D=p=>{p.preventDefault(),f(!0),R(E=>E==="zip"?"state":"zip")},t=p=>{var Z;p.preventDefault(),f(!1);const E=Ce(y.current);(Z=n==null?void 0:n.onEstimate)==null||Z.call(n,E)},I=e(oe,{"data-testid":"loading-skeleton",rowGap:"xsmall",children:e(de,{variant:"row",size:"small",lines:5,fullWidth:!0,multilineGap:"xsmall"})}),B=n&&e(L,{children:l("div",{"data-testid":"shipping-content",className:a(["dropin-price-summary__entry","dropin-price-summary__shipping"]),children:[e("span",{className:"dropin-price-summary__label",children:n.estimated?n.destinationText?l(L,{children:[e(T,{id:"Dropin.PriceSummary.shipping.estimatedDestination"}),e("a",{className:"dropin-price-summary__shippingLink",role:"button",href:"",onClick:v,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&v(p)},tabIndex:0,"aria-label":g.destinationLinkAriaLabel,"data-testid":"shipping-destination-link",children:n.destinationText})]}):e(T,{id:"Dropin.PriceSummary.shipping.estimated"}):e(T,{id:"Dropin.PriceSummary.shipping.label"})}),e(C,{node:n.price,className:"dropin-price-summary__price"}),n.estimated&&e(L,{children:e("div",{className:a(["dropin-price-summary__caption"]),children:e("a",{href:"#",className:"dropin-price-summary__shippingLink",onClick:D,"data-testid":"shipping-alternate-field-link",children:k==="zip"?e(T,{id:"Dropin.PriceSummary.shipping.alternateField.state"}):e(T,{id:"Dropin.PriceSummary.shipping.alternateField.zip"})})})}),n.estimated&&e(L,{children:l("form",{className:a(["dropin-price-summary__shipping--edit",["dropin-price-summary__shipping--hide",!z]]),ref:y,"data-testid":"shipping-estimate-form",children:[n.countryField&&e(C,{node:n.countryField,className:a(["dropin-price-summary__shipping--country"])}),k==="state"?n.stateField&&e(C,{node:n.stateField,className:a(["dropin-price-summary__shipping--state"])}):n.zipField&&e(C,{node:n.zipField,className:a(["dropin-price-summary__shipping--zip"])}),n.estimateButton&&e(C,{node:n.estimateButton,className:a(["dropin-price-summary__shipping--action"]),onClick:t,type:"submit"})]})}),n.taxIncluded&&e("div",{"data-testid":"shipping-tax-included",className:a(["dropin-price-summary__caption"]),children:e("span",{children:e(T,{id:"Dropin.PriceSummary.shipping.withTaxes"})})}),n.taxExcluded?e("div",{"data-testid":"shipping-tax-included-excluded",className:a(["dropin-price-summary__caption"]),children:l("span",{children:[n.priceExcludingTax," ",e(T,{id:"Dropin.PriceSummary.shipping.withoutTaxes"})]})}):void 0]})}),A=o&&e(L,{children:o.map(p=>l("div",{className:a(["dropin-price-summary__entry","dropin-price-summary__discount"]),children:[e("span",{className:a(["dropin-price-summary__label"]),children:p.label}),e(C,{node:p.price,className:a(["dropin-price-summary__price"])}),p.caption&&e(C,{node:p.caption,className:a(["dropin-price-summary__caption"])})]},p.label))}),V=P?e(L,{children:e(Pe,{"data-testid":"tax-breakdown",className:"dropin-price-summary__taxes",iconOpen:ie,iconClose:Ne,children:l(re,{title:g.taxesBreakdownTitle,secondaryText:!S&&_?e(C,{node:_.price,className:"dropin-price-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:b,children:[e("div",{className:a(["dropin-price-summary__appliedTaxes"]),children:P.map(p=>l("div",{className:a(["dropin-price-summary__entry","dropin-price-summary__taxEntry"]),children:[e("span",{className:a(["dropin-price-summary__label","dropin-price-summary__label--muted"]),children:p.label}),e(C,{node:p.price,className:a(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]},p.label))}),l("div",{className:a(["dropin-price-summary__entry"]),children:[e("span",{className:"dropin-price-summary__label",children:e(T,{id:"Dropin.PriceSummary.taxes.total"})}),_&&e(C,{node:_.price,className:"dropin-price-summary__price"})]})]})})}):_&&l("div",{"data-testid":"tax-total-only",className:a(["dropin-price-summary__entry","dropin-price-summary__taxTotal"]),children:[e("span",{className:"dropin-price-summary__label",children:_.estimated?e(T,{id:"Dropin.PriceSummary.taxes.estimated"}):e(T,{id:"Dropin.PriceSummary.taxes.totalOnly"})}),e(C,{node:_.price,className:"dropin-price-summary__price"})]}),M=d&&e(L,{children:l("div",{"data-testid":"total-content",className:a(["dropin-price-summary__entry","dropin-price-summary__total",d.estimated&&"dropin-price-summary__total--padded"]),children:[e("span",{className:a(["dropin-price-summary__label","dropin-price-summary__label--bold"]),children:d.estimated?e(T,{id:"Dropin.PriceSummary.total.estimated"}):e(T,{id:"Dropin.PriceSummary.total.label"})}),e(C,{node:d.price,className:a(["dropin-price-summary__price","dropin-price-summary__price--bold"])})]})}),i=d&&d.priceWithoutTax&&l("div",{"data-testid":"total-without-tax",className:"dropin-price-summary__entry dropin-price-summary__totalWithoutTax",children:[e("span",{className:a(["dropin-price-summary__label","dropin-price-summary__label--muted"]),children:e(T,{id:"Dropin.PriceSummary.total.withoutTax"})}),e(C,{node:d.priceWithoutTax,className:a(["dropin-price-summary__price","dropin-price-summary__price--muted"])})]}),F=u&&e("div",{className:a(["dropin-price-summary__entry","dropin-price-summary__primaryAction"]),children:u}),$=r&&l("div",{className:a(["dropin-price-summary__entry","dropin-price-summary__subTotal"]),children:[e("span",{className:"dropin-price-summary__label",children:e(T,{id:"Dropin.PriceSummary.subTotal.label"})}),e(C,{node:r.price,className:"dropin-price-summary__price"}),r.taxIncluded&&e("div",{"data-testid":"sub-total-tax-caption",className:a(["dropin-price-summary__caption"]),children:e("span",{children:e(T,{id:"Dropin.PriceSummary.subTotal.withTaxes"})})}),r.taxExcluded?e("div",{"data-testid":"sub-total-tax-caption-excluded",className:a(["dropin-price-summary__caption"]),children:l("span",{children:[r.priceExcludingTax," ",e(T,{id:"Dropin.PriceSummary.subTotal.withoutTaxes"})]})}):void 0]});return l("div",{...N,className:a(["dropin-price-summary",x]),children:[e("div",{className:"dropin-price-summary__heading",children:h}),e(G,{variant:"primary",className:"dropin-price-summary__divider-primary"}),c?I:l(L,{children:[$,B,A,V,M,i,F]})]})},Te=({className:x,children:m,emptyCart:s,heading:h,products:c,priceSummary:d,...r})=>e("div",{...r,className:a(["cart-cart",x]),children:l("div",{className:a(["cart-cart__wrapper"]),children:[h&&l("div",{className:a(["cart-cart__heading",["cart-cart__heading--full-width",!c||!d]]),children:[e(C,{node:h,className:"cart-cart__heading-text"}),e(G,{variant:"primary",className:a(["cart-cart__heading-divider"])})]}),e("div",{className:a(["cart-cart__content",["cart-cart__content--empty",!c],["cart-cart__content--full-width",!d]]),children:c||e(C,{node:s,className:"cart-cart__empty-cart"})}),c&&d&&e(C,{node:d,className:a(["cart-cart__price-summary"])})]})}),we=()=>{const[x,m]=w([]),[s,h]=w("US"),[c,d]=w(""),[r,n]=w(""),[_,P]=w([]),[o,u]=w(!1),[N,S]=w(),[b,y]=w(""),[z,f]=w(!1),k=ne(g=>{const{shippingCountry:v,shippingState:D="",shippingZip:t=""}=g,I={countryCode:v,postcode:t,region:{code:D}};f(!0),ge(I).then(B=>{B&&(S({amount:B.amount.value,currency:B.amount.currency}),h(v),d(D),n(t),y(D||t||v))}).finally(()=>{f(!1)})},[]),R=g=>{g.preventDefault(),d(""),n("");const v=g.target.value;h(v)};return K(()=>{xe().then(g=>{let v="US";const D=g.map(t=>(t.isDefaultCountry&&(v=t.id),{text:t.label,value:t.id}));m(D),h(v)})},[]),K(()=>{u(!0),ve(s).then(g=>{const v=g.map(D=>({text:D.name,value:D.code}));P(v)}).finally(()=>{u(!1)})},[s,u]),{loading:z,regionsLoading:o,estimatedDestinationText:b,countries:x,selectedCountry:s,selectedRegion:c,selectedZip:r,regions:_,estimatedShippingPrice:N,handleEstimateShipping:k,handleCountrySelected:R}},Fe=({children:x,initialData:m=null,routeProduct:s,routeEmptyCartCTA:h,routeCheckout:c,...d})=>{var B,A,V,M;const[r,n]=w(m),[_,P]=w(new Set),{loading:o,regionsLoading:u,countries:N,regions:S,selectedCountry:b,selectedRegion:y,selectedZip:z,estimatedDestinationText:f,estimatedShippingPrice:k,handleCountrySelected:R,handleEstimateShipping:g}=we(),v=(i,F)=>{P($=>(i?$.add(F):$.delete(F),new Set($)))},D=(i,F)=>{v(!0,i),ye([{uid:i,quantity:F}]).finally(()=>{v(!1,i)})},t=H({applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",checkout:"Cart.PriceSummary.checkout",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",freeShipping:"Cart.PriceSummary.freeShipping",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder",file:"Cart.CartItem.file",files:"Cart.CartItem.files"});K(()=>{const i=se.on("cart/data",F=>{var p,E;n(F);const $=(E=(p=F==null?void 0:F.addresses)==null?void 0:p.shipping)==null?void 0:E[0];if($){const{countryCode:Z,regionCode:Q,zipCode:U}=$;g({shippingCountry:Z,shippingState:Q,shippingZip:U})}},{eager:!0});return()=>{i==null||i.off()}},[g]),K(()=>{m&&Object.keys(m).length>0&&_e(m,ue.locale||"en-US")},[m]);const I=(r==null?void 0:r.totalQuantity)??0?e(De,{"data-testid":"price-summary",loading:o,heading:"Order Summary",total:{price:e(W,{amount:r==null?void 0:r.total.value,currency:r==null?void 0:r.total.currency}),estimated:!0},subTotal:{price:e(W,{"data-testid":"subtotal",amount:(B=r==null?void 0:r.subtotal.excludingTax)==null?void 0:B.value,currency:(A=r==null?void 0:r.subtotal.excludingTax)==null?void 0:A.currency})},shipping:r!=null&&r.isVirtual?void 0:{price:(k==null?void 0:k.amount)==0?e("span",{"data-testId":"free-shipping",children:t.freeShipping}):k?e(W,{...k}):e("span",{children:t.taxToBeDetermined}),estimated:!0,countryField:e(O,{name:"shippingCountry",placeholder:t.countryField,value:b,variant:"primary",options:N,handleSelect:R,"data-testid":"estimate-shipping-country-selector"}),stateField:S.length>0?e(O,{name:"shippingState",placeholder:t.stateField,variant:"primary",options:S,value:y,"data-testid":"estimate-shipping-state-selector",disabled:u}):e(Y,{"aria-label":t.stateField,name:"shippingState",placeholder:t.stateField,variant:"primary",value:y,disabled:u,"data-testid":"estimate-shipping-state-input",maxLength:50}),zipField:e(Y,{"aria-label":t.zipField,name:"shippingZip",placeholder:t.zipField,variant:"primary","data-testid":"estimate-shipping-zip-input",value:z,maxLength:12}),estimateButton:e(J,{variant:"secondary","data-testid":"estimate-shipping-apply-button","aria-label":t.applyButton,children:t.applyButton}),destinationText:f||t.taxToBeDetermined,onEstimate:g},taxTotal:{price:r!=null&&r.totalTax?e(W,{"data-testid":"tax-total",amount:(V=r==null?void 0:r.totalTax)==null?void 0:V.value,currency:(M=r==null?void 0:r.totalTax)==null?void 0:M.currency}):e("span",{"data-testid":"tax-total",children:t.taxToBeDetermined}),estimated:!0},primaryAction:c?e(J,{"data-testid":"checkout-button",variant:"primary",href:c({cartId:r.id}),children:t.checkout}):void 0,discounts:r==null?void 0:r.appliedDiscounts.map(i=>({label:i.label,price:e(W,{"data-testid":"summary-discount-total",amount:-i.amount.value,currency:i.amount.currency,sale:!0})}))}):void 0;return e(Te,{...d,heading:e("div",{children:t.heading}),emptyCart:e(le,{ctaLinkURL:h==null?void 0:h()}),priceSummary:I,products:(r==null?void 0:r.totalQuantity)??0?e(pe,{children:r==null?void 0:r.items.map((i,F)=>{var E,Z,Q,U;const $=_.has(i.uid),p={...i.selectedOptions??{},...i.recipient?{[t.recipient]:i.recipient}:{},...i.recipientEmail&&i.recipient?{[t.recipient]:`${i.recipient} (${i.recipientEmail})`}:{},...i.sender?{[t.sender]:i.sender}:{},...i.senderEmail&&i.sender?{[t.sender]:`${i.sender} (${i.senderEmail})`}:{},...i.message?{[t.message]:i.message}:{},...i.links&&i.links.count?i.links.count>1?{[t.files.replace("{count}",i.links.count.toString())]:i.links.result}:{[t.file.replace("{count}",i.links.count.toString())]:i.links.result}:{}};return e(me,{"data-testid":"cart-item",ariaLabel:i.name,updating:$,image:s?e("a",{href:s(i),children:e(X,{loading:F<4?"eager":"lazy",src:i.image.src,alt:i.image.alt,width:"300",height:"300",params:{width:300}})}):e(X,{loading:F<4?"eager":"lazy",src:i.image.src,alt:i.image.alt,width:"300",height:"300",params:{width:300}}),title:e("span",{children:s?e("a",{href:s(i),children:i.name}):e(L,{children:i.name})}),sku:e("span",{children:i.sku}),configurations:Object.keys(p).length>0?p:void 0,quantity:i.quantity,price:e(W,{amount:(E=i.regularPrice)==null?void 0:E.value,currency:(Z=i.regularPrice)==null?void 0:Z.currency,style:{font:"inherit"}}),total:l(L,{children:[e(W,{amount:i.total.value,currency:i.total.currency,variant:i.discounted?"strikethrough":"default","data-testid":"regular-total","aria-label":t.regularPrice}),i.discounted&&e(W,{amount:(Q=i.discountedTotal)==null?void 0:Q.value,currency:(U=i.discountedTotal)==null?void 0:U.currency,sale:i.discounted,"data-testid":"discount-total","aria-label":t.discountedPrice})]}),onQuantity:ae=>{D(i.uid,ae)},onRemove:()=>{D(i.uid,0)}},i.uid)})}):void 0})};Fe.getInitialData=async function(){return he()};export{Fe as Cart,Fe as default};
//# sourceMappingURL=Cart.js.map
